# 一、快速实现内网穿透


1. 通过FRP 实现两个常用功能
    
    - 将本地ip端口映射到公网可访问:用于测试项目
    - 公网可访间本机文件:用作文件共享的简单途径

2. 地址与文档

    - github地址：[https://github.com/fatedier/frp](https://github.com/fatedier/frp)
    - 官方文档地址：[https://gofrp.org/](https://gofrp.org/)
    - 软件下载地址：[https://github.com/fatedier/frp/releases](https://github.com/fatedier/frp/releases)

3. 配置主要分两部分：

    - frps:服务端，布局在具有公网的IP的服务器。
    - frpc:客户端，布局在内网设备。

### 1.1 安装linux服务端

1. 下载linux服务端

    ![](/network/external/frp/001.png)

2. 上传到服务器上

    ![](/network/external/frp/003.png)

3. 处理文件

    ```sh
    # 解压文件
    tar -zxvf frp_0.65.0_linux_amd64.tar.gz
    # 重命名文件
    mv frp_0.65.0_linux_amd64 frp
    # 删除客户端文件
    cd frp
    rm -rf ./frpc*
    ```
4. 修改配置文件

    - 修改文件命令

        ```sh
        vim frps.toml
        ```
    - 文件配置

        ```ini
        bindPort = 7000

        webServer.addr = "0.0.0.0"
        webServer.port = 7500
        webServer.user = "yourname"
        webServer.password = "yourpw"

        auth.method="token"
        auth.token = "thisisatoken"
        ```

5. 启动服务端

    ```sh
    ./frps
    ```
    ![](/network/external/frp/004.png)


6. 利用systemd启动后台进程挂载

    1. 创建service文件

        ```sh
        vim /etc/systemd/system/frps.service
        ```

    2. frps.service内容:

        ```ini
        [Unit]
        Description = frp server
        After = network.target syslog.target
        Wants = network.target

        [Service]
        Type=simple
        ExecStart = /mnt/frp/frps -c /mnt/frp/frps.toml

        ExecStop=/bin/kill $MAINPID
        Restart=always
        RestartSec=5

        [Install]
        WantedBy = multi-user.target
        ```

    3. 启动

        ```sh
        systemctl start frps
        systemctl status frps
        ```

        ![](/network/external/frp/005.png)

7. 开通7500端口与7000端口

    ![](/network/external/frp/006.png)

8. 远程访问7500端口

    ![](/network/external/frp/007.png)

### 1.2 安装win客户端

1. 下载windows客户端

    ![](/network/external/frp/002.png)

2. 删除服务端

3. 修改客户端配置文件

    ```ini
    # 你的云服务器公网ip
    serverAddr = "x.x.x.x"
    # 连接到云服务器端口,需要和frps.toml配置文件中端口一致
    serverPort = 7000

    auth.method = "token"
    auth.token = "thisisatoken"

    # 开放端口连接
    [[proxies]]
    name = "test-tcp"
    type = "tcp"
    localIP = "127.0.0.1"
    localPort = 8080
    remotePort = 6100

    # 共享文件访问
    [[proxies]]
    name = "d_drive"
    type = "tcp"
    remotePort = 6001  # 服务器上用于访问的端口
    [proxies.plugin]
    type = "static_file"
    localPath = "D:\\"  # 要对外暴露的目录
    stripPrefix = "d_drive"  # 访问路径名，此处即http://x.x.x.x:6001/d_drive/
    httpUser = "username"  # 用户名
    httpPassword = "password"  # 密码
    ```
4. cmd命令启动

    ```
    frpc.exe -c frpc.toml
    ```

    ![](/network/external/frp/008.png)

5. 本地配置文件有两个远程，添加服务器端口

    ![](/public/network/external/frp/009.png)

6. 访问的本地文件

    ![](/public/network/external/frp/010.png)

### 1.2 错误点