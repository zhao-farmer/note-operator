# 安装shadowsocks客户端

查找版本到shadowsocks的github主页上自己找 [github.com/shadowsocks](https://github.com/shadowsocks)

## 1.1 安装windows

1. Windows软件地址: 
    
    [https://github.com/shadowsocks/shadowsocks-windows/releases](https://github.com/shadowsocks/shadowsocks-windows/releases)

    ![](/network/external/shadowsocks/008.png)

2. 运行并配置

    - 文件目录

        ![](/network/external/shadowsocks/003.png)

    - 配置信息

        ![](/network/external/shadowsocks/004.png)

    - 设置上网模式

        ![](/network/external/shadowsocks/005.png)

3. 浏览器连接谷歌网站

    ![](/network/external/shadowsocks/006.png)


## 1.2 安装andriod

1. 安卓app地址: 

    [https://github.com/shadowsocks/shadowsocks-android/releases](https://github.com/shadowsocks/shadowsocks-android/releases)

    ![](/network/external/shadowsocks/007.png)

2. 选择联通

    ![](/network/external/shadowsocks/009.png)

## 1.3 在linux上安装（新版本是shadowsocks-rust）

1. shadowsocks-rust: 

    [https://github.com/shadowsocks/shadowsocks-android/releases](https://github.com/shadowsocks/shadowsocks-android/releases)

2. 选择linux版本类型x86

    ![](/network/external/shadowsocks/010.png)

3. 安装并启动

    - 操作命令

        ```sh
        # 解压文件
        tar -xf shadowsocks-v1.23.5.x86_64-unknown-linux-gnu.tar.xz 
        # 文件放到固定目录
        mkdir /usr/shadowsocks-client/
        mv sslocal /usr/shadowsocks-client/
        cd /usr/shadowsocks-client/
        # 配置文件
        vim config.json
        ```

    - config.json 文件

        ```json
        {
            "server": "my_server_ip",
            "server_port": 9919,
            "password": "rwQc8qPXVsRpGx3uW+Y3Lj4Y42yF9Bs0xg1pmx8/+bo=",
            "method": "aes-256-gcm",
            "local_address": "127.0.0.1",
            "local_port": 1080
        }
        ```

    - 临时启动

        ```sh
        # 启动程序
        ./sslocal -c config.json
        ```

4. 使用 privoxy

    直接使用sslocal是不能转发HTTP和HTTPS的流量的，还需要安装privoxy

    1. 安装并启动

        ```sh
        # 安装插件
        sudo yum -y install epel-release
        sudo yum -y install privoxy
        # 配置 socks5 全局代理
        echo 'forward-socks5 / 127.0.0.1:1080 .' >> /etc/privoxy/config
        # 运行 privoxy
        sudo service privoxy start
        # 检查装填
        sudo systemctl status privoxy
        # 设置开机启动
        sudo systemctl enable privoxy
        #  验证是否已启用
        sudo systemctl is-enabled privoxy
        ```
    2. 测试privoxy

        1. 使用 curl 测试

        ```sh
        curl -I --proxy http://127.0.0.1:8118 http://www.google.com
        ```
        2. 使用环境变量测试

            ```sh
            export http_proxy=http://127.0.0.1:8118
            export https_proxy=http://127.0.0.1:8118
            curl -I http://www.google.com
            ```
    3. 配置系统级代理(如果需要切换网络暂时可以不用)

        1. 为所有用户设置环境变量

            - 编辑 `/etc/environment`：

                ```bash
                sudo nano /etc/environment
                ```

            - 添加：

                ```ini
                http_proxy="http://127.0.0.1:8118"
                https_proxy="http://127.0.0.1:8118"
                ftp_proxy="http://127.0.0.1:8118"
                no_proxy="localhost,127.0.0.1,::1"
                ```

        2. 为当前用户设置

            编辑 `~/.bashrc`或 `~/.bash_profile`：

            ```bash
            echo 'export http_proxy=http://127.0.0.1:8118' >> ~/.bashrc
            echo 'export https_proxy=http://127.0.0.1:8118' >> ~/.bashrc
            echo 'export no_proxy="localhost,127.0.0.1"' >> ~/.bashrc
            source ~/.bashrc
            ```

    4. 常用管理命令

        ```bash
        # 启动服务
        sudo systemctl start privoxy

        # 停止服务
        sudo systemctl stop privoxy

        # 重启服务
        sudo systemctl restart privoxy

        # 重新加载配置（修改配置后）
        sudo systemctl reload privoxy

        # 查看服务状态
        sudo systemctl status privoxy

        # 查看服务日志
        sudo journalctl -u privoxy -f
        ```

5. 配合privoxy完成docker代理

    1.  修改配置文件：

        ```bash
        # 为Docker服务创建 systemd 配置目录
        sudo mkdir -p /etc/systemd/system/docker.service.d
        # 创建或编辑代理配置文件
        sudo vim /etc/systemd/system/docker.service.d/http-proxy.conf
        ```
    2. 配置文件

        ```sh
        [Service]
        Environment="HTTP_PROXY=http://127.0.0.1:8118"
        Environment="HTTPS_PROXY=http://127.0.0.1:8118"
        Environment="NO_PROXY=localhost,127.0.0.1,registry.access.redhat.com,registry.docker-cn.com,docker.io"
        ```
    3. 重新加载并重启 Docker

        ```sh
        sudo systemctl daemon-reload
        sudo systemctl restart docker
        ```