
# Cron表达式完全指南

## 一、Cron表达式格式

Cron表达式有两种主要格式：

### 1. **标准Unix/Linux Cron（5位）**

```text
{分钟} {小时} {日期} {月份} {星期}
*    *    *    *    *
│    │    │    │    │
│    │    │    │    └── 星期 (0-7, 0和7都代表周日)
│    │    │    └─────── 月份 (1-12)
│    │    └─────────── 日期 (1-31)
│    └──────────────── 小时 (0-23)
└───────────────────── 分钟 (0-59)
```

### 2. **扩展Cron/Quartz Cron（6-7位）**

```text
{秒} {分钟} {小时} {日期} {月份} {星期} {年份(可选)}
*  *    *    *    *    *    *
│  │    │    │    │    │    │
│  │    │    │    │    │    └── 年份 (1970-2099, 可选)
│  │    │    │    │    └─────── 星期 (1-7或SUN-SAT, 1=周日)
│  │    │    │    └─────────── 月份 (1-12或JAN-DEC)
│  │    │    └──────────────── 日期 (1-31)
│  │    └───────────────────── 小时 (0-23)
│  └─────────────────────────── 分钟 (0-59)
└────────────────────────────── 秒 (0-59)
```

## 二、字段允许值详解

| 字段  | 必填  | 允许值 | 允许的特殊字符 | 说明  |
| --- | --- | --- | --- | --- |
| 秒   | 是   | 0-59 | `, - * /` | Quartz特有 |
| 分钟  | 是   | 0-59 | `, - * /` |     |
| 小时  | 是   | 0-23 | `, - * /` | 24小时制 |
| 日期  | 是   | 1-31 | `, - * ? / L W C` | 注意大小月 |
| 月份  | 是   | 1-12 或 JAN-DEC | `, - * /` |     |
| 星期  | 是   | 1-7 或 SUN-SAT | `, - * ? / L C #` | **1=周日** |
| 年份  | 否   | 1970-2099 | `, - * /` | Quartz特有 |

## 三、特殊字符完全解析

### **基本字符**

*   `*` 所有值：表示字段的每个可能值
    
*   `?` 无指定值：用于日期和星期字段互斥
    
*   `-` 范围：`10-12` 表示10,11,12
    
*   `,` 列表：`1,3,5` 表示1或3或5
    
*   `/` 步长：`0/15` 从0开始每15单位
    

### **高级字符（Quartz特有）**

#### **L (Last) - 最后**

*   **日期字段**：`L` 表示当月最后一天
    
*   **星期字段**：`L` 表示周六，或与数字组合：`6L` 表示最后一个周五
    
*   **组合用法**：
    
    *   `L-3`：倒数第3天（日期字段）
        
    *   `FRIL`：最后一个周五（星期字段）
        

#### **W (Weekday) - 工作日**

*   **仅用于日期字段**
    
*   `15W`：最接近15号的工作日
    
    *   15号周一→15号执行
        
    *   15号周六→14号周五执行
        
    *   15号周日→16号周一执行
        
*   **限制**：
    
    *   不能用于范围或列表
        
    *   `1W`：如果1号是周六，则在上月最后一个工作日执行
        
    *   `LW`：本月最后一个工作日
        

#### **\# (第N个星期几)**

*   **仅用于星期字段**
    
*   `6#3`：每月的第3个周五
    
*   `2#1`：每月的第1个周一
    
*   如果指定的周数不存在（如`6#6`），则不触发
    

#### **C (Calendar) - 日历相关**

*   **日期字段**：`5C` = 5号之后（含5号）的第一个日历日
    
*   **星期字段**：`1C` = 周日之后（含周日）的第一个日历日
    
*   实际使用较少，多数场景可用其他方式替代
    

## 四、重要规则和冲突处理

### 1. **日期与星期的互斥性**

*   日期和星期字段**不能同时指定具体值**
    
*   必须有一个使用`?`
    
*   **正确**：`0 0 12 10 * ?`（每月10号12点）
    
*   **正确**：`0 0 12 ? * MON`（每周一12点）
    
*   **错误**：`0 0 12 10 * MON`（冲突）
    

### 2. **字段优先级**

当日期规则冲突时：

1.  星期规则优先于日期规则（如果有具体星期值）
    
2.  `L`（最后一天）具有最高优先级
    
3.  `W`（工作日）会调整到最近的工作日
    

### 3. **月份天数处理**

Cron能智能处理不同月份的天数：

*   `0 0 L * ?`：每月最后一天执行，2月28/29日，4月30日等
    
*   `0 0 31 * ?`：只在有31天的月份执行
    

## 五、实用案例大全

### **基础定时**

```cron
# 每5秒执行一次（Quartz）
*/5 * * * * ?

# 每小时的第30分钟执行
0 30 * * * ?

# 每天凌晨2点执行
0 0 2 * * ?

# 每周一上午9点
0 0 9 ? * MON

# 每月1号凌晨1点
0 0 1 1 * ?
```

### **工作日调度**

```cron
# 工作日（周一到周五）上午10:15
0 15 10 ? * MON-FRI

# 工作日上午9点到下午6点，每2小时执行
0 0 9-18/2 ? * MON-FRI

# 每月最后一个工作日17:30
0 30 17 LW * ?

# 每月10号最近的工作日（如10号是周六则在9号执行）
0 0 0 10W * ?
```

### **复杂业务场景**

```cron
# 季度报表：每季度第一个月1号
0 0 0 1 1,4,7,10 ?

# 发薪日：每月15号，如果是周末则提前到周五
0 0 0 15W * ?

# 年度审计：每年12月最后一个工作日
0 0 0 LW DEC ?

# 月末结算：每月最后一天23:30
0 30 23 L * ?

# 每周备份：周六凌晨2点
0 0 2 ? * SAT

# 每日高峰期监控：工作日的9-18点，每15分钟
0 0/15 9-18 ? * MON-FRI
```

### **特殊时间点**

```cron
# 每15分钟执行一次
0 */15 * * * ?

# 每小时的0分和30分执行
0 0,30 * * * ?

# 每天9:00-17:30，每半小时
0 0/30 9-17 * * ?

# 每月第一个和第三个周一
0 0 10 ? * 2#1,2#3

# 每年6月和12月的最后一个周五
0 0 10 ? JUN,DEC FRI#-1
```

## 六、月份和星期缩写对照表

### **月份缩写**

| 全称  | 缩写  | 数字  | 全称  | 缩写  | 数字  |
| --- | --- | --- | --- | --- | --- |
| January | JAN | 1   | July | JUL | 7   |
| February | FEB | 2   | August | AUG | 8   |
| March | MAR | 3   | September | SEP | 9   |
| April | APR | 4   | October | OCT | 10  |
| May | MAY | 5   | November | NOV | 11  |
| June | JUN | 6   | December | DEC | 12  |

### **星期缩写**

| 全称  | 缩写  | 数字（标准） | 数字（Quartz） |
| --- | --- | --- | --- |
| Sunday | SUN | 0   | 1   |
| Monday | MON | 1   | 2   |
| Tuesday | TUE | 2   | 3   |
| Wednesday | WED | 3   | 4   |
| Thursday | THU | 4   | 5   |
| Friday | FRI | 5   | 6   |
| Saturday | SAT | 6   | 7   |

**注意**：Quartz中星期日=1，星期六=7；标准Cron中星期日=0，星期六=6。

## 七、验证和调试技巧

### 1. **在线验证工具**

*   [Crontab Guru](https://crontab.guru/) - 标准5位Cron
    
*   [FreeFormatter Cron](https://www.freeformatter.com/cron-expression-generator-quartz.html) - Quartz Cron
    
*   [Cron表达式生成器](https://www.bejson.com/othertools/cron/) - 中文界面
    

### 2. **常见错误排查**

```bash
# 错误：月份使用0-11（应该是1-12）
0 0 * 0 * ?   # ❌ 错误，0不是有效月份
0 0 * 1 * ?   # ✅ 正确，1月

# 错误：日期和星期都指定具体值
0 0 12 10 * MON  # ❌ 冲突
0 0 12 10 * ?    # ✅ 每月10号
0 0 12 ? * MON   # ✅ 每周一

# 错误：超出范围的值
0 61 * * * ?     # ❌ 分钟最大59
0 0 24 * * ?     # ❌ 小时最大23
```

### 3. **测试表达式**

```bash
# Linux下测试标准Cron
crontab -l          # 查看当前任务
crontab -e          # 编辑任务
systemctl status crond  # 查看服务状态

# 打印下一次执行时间（Python示例）
import croniter
from datetime import datetime

cron = croniter.croniter('0 0 * * *', datetime.now())
next_time = cron.get_next(datetime)
print(f"下次执行时间: {next_time}")
```

## 八、平台差异和注意事项

### **不同系统的差异**

| 特性  | Linux Crontab | Spring @Scheduled | Quartz Scheduler |
| --- | --- | --- | --- |
| 字段数 | 5   | 6   | 6-7 |
| 秒字段 | 不支持 | 支持  | 支持  |
| 年份字段 | 不支持 | 不支持 | 支持  |
| 星期表示 | 0-6 (0=周日) | 1-7 (1=周日) | 1-7 (1=周日) |
| L, W, #字符 | 不支持 | 支持  | 支持  |

### **最佳实践建议**

1.  **明确环境**：确认使用的是标准Cron还是Quartz Cron
    
2.  **避免秒级调度**：除非必要，避免`*/1 * * * * ?`这样的秒级任务
    
3.  **处理闰年**：`0 0 29 2 ?` 只在闰年执行
    
4.  **时区问题**：Cron使用系统时区，分布式系统要注意时区统一
    
5.  **日志记录**：重要的定时任务要记录开始和结束时间
    
6.  **避免重叠**：长时间任务要考虑是否允许重叠执行
    

### **性能考虑**


```cron
# 不推荐：每秒执行（对系统压力大）
* * * * * ?

# 推荐：至少间隔5秒以上
*/5 * * * * ?

# 推荐：非高峰时段执行
0 0 2 * * ?    # 凌晨2点
0 30 1 * * ?   # 凌晨1:30
```

## 九、快速参考卡

```text
┌───────────── 秒 (0-59) [可选]
│ ┌─────────── 分 (0-59)
│ │ ┌───────── 时 (0-23)
│ │ │ ┌─────── 日 (1-31)
│ │ │ │ ┌───── 月 (1-12或JAN-DEC)
│ │ │ │ │ ┌─── 周 (1-7或SUN-SAT, 1=周日)
│ │ │ │ │ │
* * * * * *   [年(可选)]

特殊字符：
* 所有值          ? 不指定（日/周互斥）
, 多个值          - 范围
/ 步长            L 最后（日/周）
W 工作日          # 第N个星期几
```
