# Linux 中crontab


## 一、基本使用方法

### 1. 编辑crontab文件

```bash
# 编辑当前用户的crontab
crontab -e

# 查看当前用户的crontab
crontab -l

# 删除当前用户的crontab
crontab -r
```

### 2. 系统级crontab

```bash
# 编辑系统crontab（需要root权限）
sudo vim /etc/crontab

# 或者添加任务到/etc/cron.d/目录
sudo vim /etc/cron.d/my-task
```

## 二、常用Cron表达式示例

### 基本定时任务

```bash
# 每天凌晨2点执行
0 2 * * * /path/to/script.sh

# 每5分钟执行一次
*/5 * * * * /path/to/script.sh

# 工作日的9点到18点每小时执行
0 9-18 * * 1-5 /path/to/script.sh

# 每周日凌晨1点执行
0 1 * * 0 /path/to/script.sh

# 每月1号凌晨0点执行
0 0 1 * * /path/to/script.sh

# 每30分钟执行一次
*/30 * * * * /path/to/script.sh

# 每天10:30和22:30执行
30 10,22 * * * /path/to/script.sh
```

### 复杂示例

```bash
# 工作日的上午9点到下午6点，每30分钟执行
*/30 9-18 * * 1-5 /path/to/script.sh

# 每月的1号和15号凌晨2点执行
0 2 1,15 * * /path/to/script.sh

# 每周一到周五的9:00、12:00、18:00执行
0 9,12,18 * * 1-5 /path/to/script.sh

# 每小时的0分和30分执行
0,30 * * * * /path/to/script.sh
```

## 三、特殊字符说明

| 字符  | 说明  | 示例  |
| --- | --- | --- |
| `*` | 所有值 | `* * * * *`每分钟 |
| `,` | 指定多个值 | `0,30 * * * *`每小时的0分和30分 |
| `-` | 范围  | `0 9-18 * * *`9点到18点每小时 |
| `/` | 间隔  | `*/5 * * * *`每5分钟 |
| `?` | 不指定（仅在部分系统） | 通常用`*`代替 |

## 四、环境变量和输出重定向

```bash
# 设置环境变量并重定向输出
0 2 * * * PATH=/usr/local/bin:$PATH /path/to/script.sh > /var/log/script.log 2>&1

# 不输出任何内容
0 2 * * * /path/to/script.sh > /dev/null 2>&1

# 只输出错误到日志
0 2 * * * /path/to/script.sh > /dev/null 2>> /var/log/script-error.log
```

## 五、系统级定时任务目录

Linux还提供了更方便的目录结构：

```bash
# 每小时执行
/etc/cron.hourly/

# 每天执行
/etc/cron.daily/

# 每周执行
/etc/cron.weekly/

# 每月执行
/etc/cron.monthly/
```

## 六、查看cron日志

```bash
# 查看cron执行日志
tail -f /var/log/cron

# 或查看系统日志（不同发行版可能不同）
tail -f /var/log/syslog | grep CRON
tail -f /var/log/messages | grep cron
```

## 八、注意事项

1.  **路径问题**：在crontab中执行命令时，最好使用绝对路径
    
2.  **环境变量**：crontab的环境变量与shell不同，建议在脚本中设置
    
3.  **权限问题**：确保脚本有执行权限 `chmod +x script.sh`
    
4.  **时区问题**：crontab使用系统时区，可通过`TZ`环境变量设置
    
5.  **MAILTO**：设置邮件通知

    ```bash
    MAILTO=admin@example.com
    0 2 * * * /path/to/script.sh
    ```
    