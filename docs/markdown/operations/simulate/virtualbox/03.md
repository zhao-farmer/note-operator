
# 三、双网卡配置：实现“外网访问+主机互通”

默认情况下，虚拟机未配置网络，无法上外网也无法与物理机通信。需配置**NAT网卡（上外网）** 和**Host-Only网卡（主机与虚拟机互通）** ，两步实现网络打通。

## 3.1 第一步：在VirtualBox创建网络环境

先在VirtualBox管理器中创建两种网络，供虚拟机使用：

### 3.1.1 创建Host-Only网络（主机与虚拟机互通）

1.  关闭`centos7`虚拟机（配置网卡需关机），回到VirtualBox管理器；
    
2.  点击“管理”→“工具”→“网络管理器”，切换到“仅主机(Host-Only)网络”标签；
    
    ![](/operations/simulate/virtualBox/019.png)

3.  点击“创建”，生成新的Host-Only网络（默认名`VirtualBox Host-Only Ethernet Adapter`）；  
    
    ![](/operations/simulate/virtualBox/020.png)
    
4.  点击“属性”，配置参数：
    
    *   IPv4地址：默认`192.168.56.1`（物理机在该网络的IP）；
    *   子网掩码：`255.255.255.0`；
    *   地址范围：最小`192.168.56.101`，最大`192.168.56.254`（虚拟机IP需在该范围内）；
    *   点击“应用”保存。  
       

    ![](/operations/simulate/virtualBox/021.png)

### 3.1.2 创建NAT网络（虚拟机上外网）

1.  在“网络”界面切换到“NAT网络”标签；
2.  点击“创建”，生成新的NAT网络（默认名`NatNetwork`）；
3.  点击“属性”，配置参数：
    *   IPv4网络：`10.0.2.0/24`（子网掩码`255.255.255.0`）；
    *   启用DHCP：勾选“DHCP服务器”（虚拟机可自动获取外网IP）；
    *   点击“应用”保存。  
      
    ![](/operations/simulate/virtualBox/022.png)

## 3.2 第二步：为虚拟机添加双网卡

1.  选中`node1`虚拟机，点击“设置-网络”；
    
2.  **添加NAT网卡（网卡1）** ：
    
    *   勾选“启用网络连接”；
    *   连接方式：选择“网络地址转换(NAT)”；
    *   名称：选择刚才创建的`NatNetwork`；
    *   点击“确定”暂存。  
    

    ![](/operations/simulate/virtualBox/023.png)

3.  **添加Host-Only网卡（网卡2）** ：
    
    *   点击“网卡2”标签，勾选“启用网络连接”；
    *   连接方式：选择“仅主机(Host-Only)网络”；
    *   名称：选择刚才创建的`VirtualBox Host-Only Ethernet Adapter`；
    *   点击“确定”保存配置。  
    

    ![](/operations/simulate/virtualBox/024.png)

## 3.3 第三步：配置虚拟机内网卡文件

启动`node1`虚拟机，用root登录（`[root@localhost ~]#`），通过命令行配置网卡参数：

### 3.3.1 查看网卡名称

输入命令`ip addr`，查看系统识别的网卡：

*   通常`enp0s3`对应NAT网卡（第一张网卡）；
*   `enp0s8`对应Host-Only网卡（第二张网卡）（若未显示，重启虚拟机即可识别）。  
  
![](/operations/simulate/virtualBox/025.png)

### 3.3.2 配置NAT网卡（enp0s3）

NAT网卡用DHCP自动获取IP，只需设置“开机加载”：

1.  进入网络配置文件目录：`cd /etc/sysconfig/network-scripts`；
2.  编辑enp0s3配置文件：`vi ifcfg-enp0s3`（vi是Linux默认编辑器）；  
    
    ![](/operations/simulate/virtualBox/026.png)

3.  进入编辑模式：按`i`键，找到`ONBOOT=no`，修改为`ONBOOT=yes`（作用：开机自动加载该网卡）；  
  
    ![](/operations/simulate/virtualBox/027.png)

4.  保存退出：按`ESC`键，输入`:wq`（冒号+wq，意为“写入并退出”），按回车。

### 3.3.3 配置Host-Only网卡（enp0s8）

Host-Only网卡需用**静态IP**（便于主机固定访问），步骤如下：

1.  复制enp0s3的配置文件，生成enp0s8的配置：`cp ifcfg-enp0s3 ifcfg-enp0s8`；
2.  生成新UUID（避免与enp0s3冲突）：`uuidgen ifcfg-enp0s8`，复制输出的UUID（如`6fa10f9d-1a99-47b7-8be4-a2e6e6c2c5db`）；  
    
    ![](/operations/simulate/virtualBox/028.png)

3.  编辑enp0s8配置文件：`vi ifcfg-enp0s8`，按`i`进入编辑模式，修改以下参数：
    *   `BOOTPROTO=dhcp` → `BOOTPROTO=static`（静态IP）；
    *   `NAME=enp0s3` → `NAME=enp0s8`（网卡名匹配）；
    *   `DEVICE=enp0s3` → `DEVICE=enp0s8`（设备名匹配）；
    *   `UUID=xxx` → 替换为刚才复制的新UUID；  
      
    ![](/operations/simulate/virtualBox/029.png)

    *   在文件末尾新增3行（IP需在Host-Only地址范围内，如`192.168.56.120`）：
        
        ```plain
        IPADDR=192.168.56.120
        NETMASK=255.255.255.0
        GATEWAY=192.168.56.1
        ```
        
4.  保存退出：按`ESC`，输入`:wq`回车。

## 3.4 第四步：重启网络并测试连通性

1.  重启网络服务：`service network restart`，显示`[ OK ]`表示重启成功；  
   
    ![](/operations/simulate/virtualBox/030.png)

2.  **测试外网连通性**： ping百度4次（避免无限ping）：`ping www.baidu.com -c 4`；
    *   若显示“4 packets transmitted, 4 received”（4个包发送，4个接收），说明NAT网卡生效，虚拟机可上外网；  

    ![](/operations/simulate/virtualBox/031.png)

3.  **测试主机与虚拟机互通**：
    *   物理机打开终端（Windows用cmd，macOS/Linux用终端），ping虚拟机的Host-Only IP：`ping 192.168.56.120`；
    *   若显示“来自 192.168.56.120 的回复”，说明Host-Only网卡生效，主机与虚拟机可互通。  

    ![](/operations/simulate/virtualBox/032.png)